# secure-chat
Contributors: Hamim Seam and Angus Chen

### Libraries Used
- OpenSSL (for RSA, HMAC, AES)
- GTK+3 (for GUI)
- GMP (GNU Multiple Precision arithmetic library)
- pthreads – for multi-threading (to handle incoming messages without blocking the UI)

- MacOS installation: brew install openssl@3 gtk+3 gmp
- Linux/WSL installation: sudo apt install libssl-dev libgtk-3-dev libgmp-dev

### Usage
- Compilation: `make`
- Compilation (MacOS): `make -f Makefile.macos`
- Running: `./chat -l & sleep 1 && ./chat -c localhost`
    Note: This will run both server and client in the same terminal window. For clarity, use two separate terminals.

### Project Structure
- `chat.c`: Main GUI and network loop
- `util.c/h`: RSA signature and HMAC utilities
- `dh.c/h`: Diffie-Hellman logic
- `keys.c/h`: RSA key generation and serialization
- `Makefile` / `Makefile.macos`: Build files (Linux/WSL and macOS)

### Procedure
1. Server and client generate public and private RSA keys before establishing a connection.
	- The keys are already stored in the repository's `keys` directory.
	- If the keys are not present, use `generate_rsa_keys` in `util.c` to create them.
2. Server and client generate a Diffie-Hellman key pair, using the functions in `dh.c`.
3. Server and client each sign their public Diffie-Hellman keys with their private RSA keys, and send both the DH public key and this signature over the channel.
4. Both parties verify the received signature using the other party's public RSA key, ensuring that it matches the Diffie-Hellman public key.
5. The Diffie-Hellman shared secret, generated by each party from their own secret keys and the received public keys is used as the key for HMAC.
6. Every message is encrypted with AES and then sent along with its corresponding HMAC. If the HMAC is verified to match the AES encrypted text, the text is decrypted and the message displayed to the recipient.

### Assumptions
Key Distribution: The keys have been securely shared prior to the session (these keys are stored in keys/ directory).
Parameter Trust: Diffie-Hellman parameters (p, q, g) are assumed to be securely generated and not tampered with.
No Adversary in Setup: It is assumed that the environment the RSA/DH key generation/distribution occurs in is trusted and free from adversarial interference.
Adversary Capabilities: It is assumed that the adversary is computationally bounded (no quantum computing or side-channel capabilities).
Replay Attacks Not Mitigated: The current protocol does not defend against message replays due to not using timestamps, nonces, or sequence numbers.


### Claims
Confidentiality: Messages are encrypted using AES-256-CBC with keys derived from a DH shared secret, ensuring secrecy against passive eavesdroppers.
Integrity: Each message includes a SHA-256-based HMAC for tamper detection.
Mutual Authentication: Both client and server verify each other’s DH keys via RSA signatures to prevent man-in-the-middle attacks.

### Implemented Security Measures
- **Authentication of correspondents**: RSA signing using keys pre-exchanged securely.
- **Message secrecy (encryption)**: AES encryption/decryption with an ephemeral shared secret key via Diffie-Hellman.
- **Message integrity (MACs)**: Applied as HMAC(ENC(m)), and sent along with encoded message for verification.

### Notes
- All of the student-written functions are written in `util.c`, and called in `chat.c`.